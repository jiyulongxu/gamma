!function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(){return(e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},n=function(t,e,n,o){n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.closePath(),n.strokeStyle=t.linkColor||"#ccc",n.stroke()},o=function(t,e,n,o,i){void 0===i&&(i={label:!0});var r=t.size||o("nodeSize"),s=t.color||o("hoverNodeColor"),a=o("hoverLabelColor"),l=o("hoverLabel");if(e.beginPath(),e.arc(t.x,t.y,r+1,0,2*Math.PI),e.closePath(),e.fillStyle=s,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#666",e.fill(),i.label){var h=t[l];if(h){var c=14/n.k;e.font=c+"px sans-serif",e.fillStyle=a,e.fillText(h,t.x+r+2,t.y+c/3)}}},i=function(){function i(e,n,o,i){var r=this;this.manager=e,this.setting=n,this.container=o,this.option=i,this.zoom=t.zoom().scaleExtent([.1,4]).on("zoom",this.zooming.bind(this)),this.contexts={},this.transfrom=t.zoomIdentity,this.hoveredNode=null,this.hoveredTargets=[],this.tooltipFormat=function(t){return JSON.stringify(t,null,2)},this.overallFormat=function(t){return"节点总数："+t.nodes.length},this.resize=function(){var e=parseInt(t.select(r.container).style("width"));r.zoom.translateBy(r.canvas,(e-r.width)/2,0),r.width=r.option.width||e,r.canvas.attr("width",r.width),r.render()},this.handleMouse=function(){var e=r.transfrom,n=e.x,o=e.y,i=e.k,s=t.event.layerX,a=t.event.layerY,l=t.event.type,h=[(s-n)/i,(a-o)/i],c=h[0],d=h[1],f=r.manager.find(c,d),u=f.size||r.setting("nodeSize");Math.pow(c-f.x,2)+Math.pow(d-f.y,2)<=Math.pow(u,2)?(r.hoveredTargets=r.manager.graph.links.filter((function(t){return t.source===f})).map((function(t){return t.target})),r.hoveredNode=f,r.renderHover(),"click"===l&&r.tooltip.style("display","block").text(r.tooltipFormat(f))):(r.hoveredNode=null,r.hoveredTargets=[],r.clear("hover"),"click"===l&&r.tooltip.style("display","none"))};var s=parseInt(t.select(o).style("width"));i.tooltip&&i.tooltip.format&&(this.tooltipFormat=i.tooltip.format),i.overall&&i.overall.format&&(this.overallFormat=i.overall.format),this.width=i.width||s,this.canvas=t.select(o).append("div").attr("class","gamma-container").style("height",this.option.height+"px").style("position","relative").selectAll("canvas").data(["gamma-scene","gamma-hover"]).enter().append("canvas").style("position","absolute").style("top",0).style("left",0).attr("width",this.width).attr("height",i.height).attr("class",(function(t){return t})).call(this.zoom),this.tooltip=t.select(o).select(".gamma-container").append("pre").style("position","absolute").style("display","none").style("top",0).style("right",0).style("width","300px"),this.overall=t.select(o).select(".gamma-container").append("div").style("position","absolute").style("left",0).style("bottom",0).style("width","250px").style("padding","10px"),this.canvas.filter((function(t){return"gamma-hover"===t})).on("mousemove click",this.handleMouse);var a=this.canvas.nodes().map((function(t){return t.getContext("2d")})),l=a[0],h=a[1];this.contexts.scene=l,this.contexts.hover=h,this.zoom.translateBy(this.canvas,this.width/2,i.height/2),e.on("tick",(function(){r.render(),r.hoveredNode&&r.renderHover()})).on("layout",(function(){r.tooltip.style("display","none"),r.overall.html(r.overallFormat(r.manager.graph))})),window.addEventListener("resize",this.resize)}return i.prototype.zooming=function(){this.transfrom=t.event.transform,this.manager.simulationIsRuning||this.render(),this.hoveredNode&&this.renderHover()},i.prototype.setTransfrom=function(t){var e=this.transfrom,n=e.x,o=e.y,i=e.k;t.translate(n,o),t.scale(i,i)},i.prototype.renderHover=function(){var t=this;this.clear("hover"),this.contexts.hover.save(),this.setTransfrom(this.contexts.hover),this.hoveredTargets.forEach((function(i){n(e(e({},t.hoveredNode),{linkColor:"pink"}),i,t.contexts.hover,t.setting),o(e(e({},i),{color:"pink"}),t.contexts.hover,t.transfrom,t.setting,{label:!1})})),o(this.hoveredNode,this.contexts.hover,this.transfrom,this.setting),this.contexts.hover.restore()},i.prototype.render=function(){var t=this;this.clear("scene"),this.contexts.scene.save(),this.setTransfrom(this.contexts.scene),this.manager.graph.links.forEach((function(e){n(e.source,e.target,t.contexts.scene,t.setting)})),this.manager.graph.nodes.forEach((function(e){!function(t,e,n){var o=t.size||n("nodeSize"),i=t.color||n("nodeColor");e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.closePath(),e.fillStyle=i,e.fill()}(e,t.contexts.scene,t.setting)})),this.contexts.scene.restore(),this.option.legend&&this.renderLegend()},i.prototype.renderLegend=function(){!function(t,n,o){n.save();var i=0;n.font="14px sans-serif";var r=t.map((function(t){var o=n.measureText(t.name).width,r=i;return i+=25+o+10,e(e({},t),{textWidth:o,x:r})})),s=(o-i)/2;r.forEach((function(t,e){n.fillStyle=t.color,n.fillRect(s+t.x,10,20,12),n.textBaseline="middle",n.fillText(t.name,s+t.x+20+5,16)})),n.restore()}(this.option.legend,this.contexts.scene,this.width)},i.prototype.clear=function(t){var e=this.option.height;if(!0===t)for(var n in this.contexts)this.contexts[n].clearRect(0,0,this.width,e);else this.contexts[t].clearRect(0,0,this.width,e)},i.prototype.destory=function(){window.removeEventListener("resize",this.resize),this.zoom.on("zoom",null),this.canvas.filter((function(t){return"gamma-hover"===t})).on("mousemove click",null)},i}();var r=function(){function e(){var e=this;this.simulation=t.forceSimulation(),this.ticks=new Set,this.ends=new Set,this.layouts=new Set,this.simulationIsRuning=!1,this.graph={nodes:[],links:[]},this.layout=function(t){e.simulationIsRuning=!0,e.graph=t,e.simulation.nodes(t.nodes).alpha(1).alphaTarget(0).restart().force("link").links(t.links),e.layouts.forEach((function(t){return t.call(e)}))},this.simulation.force("charge",t.forceManyBody().theta(.5).distanceMax(1e3).strength(-100)).force("link",t.forceLink().id((function(t){return t.id})).iterations(10).distance(40).strength(.5)).force("center",t.forceCenter()).force("collide",t.forceCollide(6)).force("x",t.forceX().strength(.1)).force("y",t.forceY().strength(.1)).on("tick",(function(){e.ticks.forEach((function(t){return t.call(e)}))})).on("end",(function(){e.simulationIsRuning=!1,e.ends.forEach((function(t){return t.call(e)}))}))}return e.prototype.destory=function(){this.simulation.on("tick",null).on("end",null)},e.prototype.find=function(t,e){return this.simulation.find(t,e)},e.prototype.on=function(t,e){return"tick"===t?this.ticks.add(e):"end"===t?this.ends.add(e):"layout"===t&&this.layouts.add(e),this},e.prototype.off=function(t,e){return"tick"===t?this.ticks.delete(e):"end"===t?this.ends.delete(e):"layout"===t&&this.layouts.delete(e),this},e}(),s=function(){function e(e){var n,o;this.height=800,this.manager=new r,this.onEnd=function(){},e.container||console.log("no container"),e.height&&(this.height=e.height),e.onEnd&&(this.onEnd=e.onEnd),t.select(e.container).selectAll("*").remove(),this.renderer=new i(this.manager,(n=e.graphSettings,o={nodeSize:3,nodeColor:"green",hoverNodeColor:"green",hoverLabelColor:"#333",hoverLabel:"label"},Object.assign(o,n),function(t){return o[t]}),e.container,{width:this.width,height:this.height,legend:e.legend,tooltip:e.tooltip,overall:e.overall}),this.manager.layout(e.graph)}return e.prototype.refreshWithGraph=function(t){this.manager.layout(t)},e.prototype.destory=function(){this.renderer.destory(),this.manager.destory()},e}();fetch("./data.json").then((function(t){return t.json()})).then((function(t){var e=new s({graph:{nodes:t.nodes,links:t.links},container:"#mount",graphSettings:{hoverLabel:"id"},height:500,onEnd:function(){console.log("end")},legend:[{color:"red",name:"老师"},{color:"blue",name:"学生"}],tooltip:{format:function(t){return JSON.stringify(t,null,2)}}});document.addEventListener("dblclick",(function(t){t.target===this.documentElement&&fetch("./g.json").then((function(t){return t.json()})).then((function(t){e.refreshWithGraph({nodes:t.nodes,links:t.edges})}))}))}))}(d3);
//# sourceMappingURL=main.js.map
