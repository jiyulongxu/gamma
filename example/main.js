!function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(){return(e=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},o=function(t,e,o,n){o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(e.x,e.y),o.closePath(),o.strokeStyle=t.linkColor||"#ccc",o.stroke()},n=function(t,e,o,n,i){void 0===i&&(i={label:!0});var r=t.size||n("nodeSize"),s=t.color||n("hoverNodeColor"),a=n("hoverLabelColor"),h=n("hoverLabel");if(e.beginPath(),e.arc(t.x,t.y,r+1,0,2*Math.PI),e.closePath(),e.fillStyle=s,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#666",e.fill(),i.label){var l=t[h];if(l){var c=14/o.k;e.font=c+"px sans-serif",e.fillStyle=a,e.fillText(l,t.x+r+2,t.y+c/3)}}},i=function(){function i(e,o,n,i){var r=this;this.manager=e,this.setting=o,this.container=n,this.option=i,this.zoom=t.zoom().scaleExtent([.1,4]).translateExtent([[-5e3,-3e3],[5e3,3e3]]).on("zoom",this.zooming.bind(this)),this.contexts={},this.transform=t.zoomIdentity,this.hoveredNode=null,this.hoveredTargets=[],this.viewFited=!1,this.tooltipFormat=function(t){return JSON.stringify(t,null,2)},this.overallFormat=function(t){return"节点总数："+t.nodes.length+"<br>transform:<br>x:"+this.transform.x+"<br>y:"+this.transform.y+"<br>k:"+this.transform.k},this.resize=function(){var e=parseInt(t.select(r.container).style("width"));r.zoom.translateBy(r.canvas,(e-r.width)/2,0),r.width=r.option.width||e,r.canvas.attr("width",r.width),r.render()},this.handleMouse=function(){var e=r.transform,o=e.x,n=e.y,i=e.k,s=t.event.layerX,a=t.event.layerY,h=t.event.type,l=[(s-o)/i,(a-n)/i],c=l[0],d=l[1],f=r.manager.find(c,d),u=f.size||r.setting("nodeSize");if(Math.pow(c-f.x,2)+Math.pow(d-f.y,2)<=Math.pow(u,2)){if(r.hoveredTargets=r.manager.graph.links.filter((function(t){return t.source===f})).map((function(t){return t.target})),r.hoveredNode=f,r.renderHover(),"click"===h){var p=r.tooltipFormat(f);p&&r.tooltip.style("display","block").text(p)}}else r.hoveredNode=null,r.hoveredTargets=[],r.clear("hover"),"click"===h&&r.tooltip.style("display","none")};var s=parseInt(t.select(n).style("width"));i.tooltip&&i.tooltip.format&&(this.tooltipFormat=i.tooltip.format),i.overall&&i.overall.format&&(this.overallFormat=i.overall.format),this.width=i.width||s,this.height=i.height||500,this.canvas=t.select(n).append("div").attr("class","gamma-container").style("height",this.height+"px").style("position","relative").selectAll("canvas").data(["gamma-scene","gamma-hover"]).enter().append("canvas").style("position","absolute").style("top",0).style("left",0).attr("width",this.width).attr("height",this.height).attr("class",(function(t){return t})).call(this.zoom),this.buildTooltip(),this.canvas.filter((function(t){return"gamma-hover"===t})).on("mousemove click",this.handleMouse);var a=this.canvas.nodes().map((function(t){return t.getContext("2d")})),h=a[0],l=a[1];this.contexts.scene=h,this.contexts.hover=l,this.zoom.translateBy(this.canvas,this.width/2,this.height/2),e.on("tick",(function(){r.render(),r.hoveredNode&&r.renderHover()})).on("layout",(function(){r.tooltip.style("display","none")})),window.addEventListener("resize",this.resize)}return i.prototype.buildOverall=function(){},i.prototype.buildTooltip=function(){this.tooltip=t.select(this.container).select(".gamma-container").append("pre").style("position","absolute").style("display","none").style("top",0).style("right",0).style("width","300px")},i.prototype.zooming=function(){this.transform=t.event.transform,this.manager.simulationIsRuning||this.render(),this.hoveredNode&&this.renderHover()},i.prototype.setTransfrom=function(t){var e=this.transform,o=e.x,n=e.y,i=e.k;t.translate(o,n),t.scale(i,i)},i.prototype.renderHover=function(){var t=this;this.clear("hover"),this.contexts.hover.save(),this.setTransfrom(this.contexts.hover),this.hoveredTargets.forEach((function(i){o(e(e({},t.hoveredNode),{linkColor:"pink"}),i,t.contexts.hover,t.setting),n(e(e({},i),{color:"pink"}),t.contexts.hover,t.transform,t.setting,{label:!1})})),n(this.hoveredNode,this.contexts.hover,this.transform,this.setting),this.contexts.hover.restore()},i.prototype.render=function(){var t=this;this.clear("scene"),this.contexts.scene.save(),this.setTransfrom(this.contexts.scene),this.manager.graph.links.forEach((function(e){o(e.source,e.target,t.contexts.scene,t.setting)})),this.manager.graph.nodes.forEach((function(e){!function(t,e,o){var n=t.size||o("nodeSize"),i=t.color||o("nodeColor");e.beginPath(),e.arc(t.x,t.y,n,0,2*Math.PI),e.closePath(),e.fillStyle=i,e.fill()}(e,t.contexts.scene,t.setting)})),this.contexts.scene.restore(),this.option.legend&&this.renderLegend()},i.prototype.renderLegend=function(){!function(t,o,n){o.save();var i=0;o.font="14px sans-serif";var r=t.map((function(t){var n=o.measureText(t.name).width,r=i;return i+=25+n+10,e(e({},t),{textWidth:n,x:r})})),s=(n-i)/2;r.forEach((function(t,e){o.fillStyle=t.color,o.fillRect(s+t.x,10,20,12),o.textBaseline="middle",o.fillText(t.name,s+t.x+20+5,16)})),o.restore()}(this.option.legend,this.contexts.scene,this.width)},i.prototype.clear=function(t){var e=this.option.height;if(!0===t)for(var o in this.contexts)this.contexts[o].clearRect(0,0,this.width,e);else this.contexts[t].clearRect(0,0,this.width,e)},i.prototype.destory=function(){window.removeEventListener("resize",this.resize),this.zoom.on("zoom",null),this.canvas.filter((function(t){return"gamma-hover"===t})).on("mousemove click",null)},i}();var r=function(){function e(){var e=this;this.simulation=t.forceSimulation(),this.ticks=new Set,this.ends=new Set,this.layouts=new Set,this.simulationIsRuning=!1,this.graph={nodes:[],links:[]},this.layout=function(t){e.simulationIsRuning=!0,e.graph=t,e.simulation.nodes(t.nodes).alpha(1).alphaTarget(0).restart().force("link").links(t.links),e.layouts.forEach((function(t){return t.call(e)}))},this.simulation.force("charge",t.forceManyBody().theta(.5).distanceMax(1e3).strength(-100)).force("link",t.forceLink().id((function(t){return t.id})).iterations(10).distance(40).strength(.5)).force("center",t.forceCenter()).force("collide",t.forceCollide(6)).force("x",t.forceX().strength(.1)).force("y",t.forceY().strength(.1)).on("tick",(function(){e.ticks.forEach((function(t){return t.call(e)}))})).on("end",(function(){e.simulationIsRuning=!1,e.ends.forEach((function(t){return t.call(e)}))}))}return e.prototype.destory=function(){this.simulation.on("tick",null).on("end",null)},e.prototype.find=function(t,e){return this.simulation.find(t,e)},e.prototype.on=function(t,e){return"tick"===t?this.ticks.add(e):"end"===t?this.ends.add(e):"layout"===t&&this.layouts.add(e),this},e.prototype.off=function(t,e){return"tick"===t?this.ticks.delete(e):"end"===t?this.ends.delete(e):"layout"===t&&this.layouts.delete(e),this},e}(),s=function(){function e(e){var o,n;this.height=800,this.manager=new r,this.onEnd=function(){},e.container||console.log("no container"),e.height&&(this.height=e.height),e.onEnd&&(this.onEnd=e.onEnd),t.select(e.container).selectAll("*").remove(),this.renderer=new i(this.manager,(o=e.graphSettings,n={nodeSize:3,nodeColor:"green",hoverNodeColor:"green",hoverLabelColor:"#333",hoverLabel:"label"},Object.assign(n,o),function(t){return n[t]}),e.container,{width:this.width,height:this.height,legend:e.legend,tooltip:e.tooltip,overall:e.overall}),this.manager.layout(e.graph)}return e.prototype.refreshWithGraph=function(t){this.manager.layout(t)},e.prototype.destory=function(){this.renderer.destory(),this.manager.destory()},e}();fetch("./g.json").then((function(t){return t.json()})).then((function(t){var e=new s({graph:{nodes:t.nodes,links:t.edges},container:"#mount",graphSettings:{hoverLabel:"id"},height:500,onEnd:function(){console.log("end")},legend:[{color:"red",name:"老师"},{color:"blue",name:"学生"}],tooltip:{format:function(t){return JSON.stringify(t,null,2)}}});window.g=e}))}(d3);
//# sourceMappingURL=main.js.map
