!function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(){return(e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},n=function(t,e,n,o){n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y),n.closePath(),n.strokeStyle=t.linkColor||"#ccc",n.stroke()},o=function(t,e,n,o,i){void 0===i&&(i={label:!0});var r=t.size||o("nodeSize"),s=t.color||o("hoverNodeColor"),a=o("hoverLabelColor"),h=o("hoverLabel");if(e.beginPath(),e.arc(t.x,t.y,r+1,0,2*Math.PI),e.closePath(),e.fillStyle=s,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=8,e.shadowColor="#666",e.fill(),i.label){var c=t[h];if(c){var l=14/n.k;e.font=l+"px sans-serif",e.fillStyle=a,e.fillText(c,t.x+r+2,t.y+l/3)}}},i=function(){function i(e,n,o,i){var r=this;this.manager=e,this.setting=n,this.option=i,this.zoom=t.zoom().scaleExtent([.1,4]).on("zoom",this.zooming.bind(this)),this.contexts={},this.transfrom=t.zoomIdentity,this.hoveredNode=null,this.hoveredTargets=[],this.selectedSource=[],this.canvas=t.select(o).append("div").attr("class","gamma-container").style("position","relative").selectAll("canvas").data(["gamma-scene","gamma-hover"]).enter().append("canvas").style("position","absolute").style("top",0).style("left",0).attr("width",i.width).attr("height",i.height).attr("class",(function(t){return t})).call(this.zoom),this.canvas.filter((function(t){return"gamma-hover"===t})).on("mousemove",(function(){var n=r.transfrom,o=n.x,i=n.y,s=n.k,a=t.event.layerX,h=t.event.layerY,c=(t.event.type,[(a-o)/s,(h-i)/s]),l=c[0],f=c[1],d=e.find(l,f);Math.pow(l-d.x,2)+Math.pow(f-d.y,2)<9?(r.hoveredTargets=r.manager.graph.links.filter((function(t){return t.source===d})).map((function(t){return t.target})),r.hoveredNode=d,r.renderHover()):(r.hoveredNode=null,r.hoveredTargets=[],r.clear("hover"))}));var s=this.canvas.nodes().map((function(t){return t.getContext("2d")})),a=s[0],h=s[1];this.contexts.scene=a,this.contexts.hover=h,this.zoom.translateBy(this.canvas,i.width/2,i.height/2),e.on("tick",(function(){r.render(),r.hoveredNode&&r.renderHover()}))}return i.prototype.zooming=function(){this.transfrom=t.event.transform,this.manager.simulationIsRuning||this.render(),this.hoveredNode&&this.renderHover()},i.prototype.setTransfrom=function(t){var e=this.transfrom,n=e.x,o=e.y,i=e.k;t.translate(n,o),t.scale(i,i)},i.prototype.renderHover=function(){var t=this;this.clear("hover"),this.contexts.hover.save(),this.setTransfrom(this.contexts.hover),this.hoveredTargets.forEach((function(i){n(e(e({},t.hoveredNode),{linkColor:"pink"}),i,t.contexts.hover,t.setting),o(e(e({},i),{color:"pink"}),t.contexts.hover,t.transfrom,t.setting,{label:!1})})),o(this.hoveredNode,this.contexts.hover,this.transfrom,this.setting),this.contexts.hover.restore()},i.prototype.render=function(){var t=this;this.contexts.scene.clearRect(0,0,this.option.width,this.option.height),this.contexts.scene.save(),this.setTransfrom(this.contexts.scene),this.manager.graph.links.forEach((function(e){n(e.source,e.target,t.contexts.scene,t.setting)})),this.manager.graph.nodes.forEach((function(e){!function(t,e,n){var o=t.size||n("nodeSize"),i=t.color||n("nodeColor");e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI),e.closePath(),e.fillStyle=i,e.fill()}(e,t.contexts.scene,t.setting)})),this.contexts.scene.restore()},i.prototype.clear=function(t){var e=this.option,n=e.width,o=e.height;if(!0===t)for(var i in this.contexts)this.contexts[i].clearRect(0,0,n,o);else this.contexts[t].clearRect(0,0,n,o)},i}();var r=function(){function e(){var e=this;this.simulation=t.forceSimulation(),this.ticks=new Set,this.ends=new Set,this.simulationIsRuning=!1,this.graph={nodes:[],links:[]},this.layout=function(t){e.simulationIsRuning=!0,e.graph=t,e.simulation.nodes(t.nodes).alpha(1).alphaTarget(0).restart().force("link").links(t.links)},this.simulation.force("charge",t.forceManyBody().theta(.5).distanceMax(1e3).strength(-100)).force("link",t.forceLink().id((function(t){return t.id})).iterations(10).distance(40).strength(.5)).force("center",t.forceCenter()).force("collide",t.forceCollide(6)).force("x",t.forceX().strength(.1)).force("y",t.forceY().strength(.1)).on("tick",(function(){e.ticks.forEach((function(t){return t.call(e)}))})).on("end",(function(){e.simulationIsRuning=!1,e.ends.forEach((function(t){return t.call(e)}))}))}return e.prototype.find=function(t,e){return this.simulation.find(t,e)},e.prototype.on=function(t,e){"tick"===t?this.ticks.add(e):"end"===t&&this.ends.add(e)},e.prototype.off=function(t,e){"tick"===t?this.ticks.delete(e):"end"===t&&this.ends.delete(e)},e}(),s=function(){function e(e){var n,o;this.width=800,this.height=800,this.manager=new r,this.onEnd=function(){},e.container||console.log("no container"),e.onEnd&&(this.onEnd=e.onEnd),t.select(e.container).selectAll("*").remove(),this.manager.layout(e.graph),this.renderer=new i(this.manager,(n=e.graphSettings,o={nodeSize:3,nodeColor:"green",hoverNodeColor:"green",hoverLabelColor:"#333",hoverLabel:"label"},Object.assign(o,n),function(t){return o[t]}),e.container,{width:this.width,height:this.height})}return e.prototype.refreshWithGraph=function(t){this.manager.layout(t)},e}();fetch("./data.json").then((function(t){return t.json()})).then((function(t){var e=new s({graph:{nodes:t.nodes,links:t.links},container:"#mount",graphSettings:{hoverLabel:"id"},onEnd:function(){console.log("end")}});document.addEventListener("dblclick",(function(t){t.target===this.documentElement&&fetch("./g.json").then((function(t){return t.json()})).then((function(t){e.refreshWithGraph({nodes:t.nodes,links:t.edges})}))}))}))}(d3);
//# sourceMappingURL=main.js.map
